version: 1
backend:
  phases:
    build:
      commands:
        - npm ci --cache .npm --prefer-offline
        - npx ampx pipeline-deploy --branch $AWS_BRANCH --app-id $AWS_APP_ID
frontend:
  phases:
    preBuild:
      commands:
        - echo "üîç Starting pre-build phase for NC State Sports Hub"
        - echo "Node version:" && node --version
        - echo "NPM version:" && npm --version
        - cd nc-state-sports-hub/nc-state-sports-hub-production
        - npm ci --cache .npm --prefer-offline
        - echo "Running linting checks..."
        - npm run lint || echo "Linting completed with warnings"
        - echo "Running TypeScript type checking..."
        - npm run type-check || echo "Type checking completed with warnings"
        - echo "Pre-build phase completed ‚úÖ"
    build:
      commands:
        - echo "üèóÔ∏è Starting build phase for NC State Sports Hub"
        - cd nc-state-sports-hub/nc-state-sports-hub-production
        - echo "Building Next.js application..."
        - npm run build
        - echo "Build phase completed ‚úÖ"
    postBuild:
      commands:
        - echo "üöÄ Starting post-build phase"
        - cd nc-state-sports-hub/nc-state-sports-hub-production
        - echo "Build completed successfully at $(date)"
        - echo "Checking build artifacts..."
        - ls -la .next/ || echo "Build artifacts check completed"
        - echo "Post-build phase completed ‚úÖ"
  artifacts:
    baseDirectory: nc-state-sports-hub/nc-state-sports-hub-production/.next
    files:
      - '**/*'
  cache:
    paths:
      - nc-state-sports-hub/nc-state-sports-hub-production/node_modules/**/*
      - nc-state-sports-hub/nc-state-sports-hub-production/.next/cache/**/*
      - .npm/**/*