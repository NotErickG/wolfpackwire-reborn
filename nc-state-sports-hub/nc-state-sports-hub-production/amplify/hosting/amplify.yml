version: 1
applications:
  - appRoot: .
    frontend:
      phases:
        preBuild:
          commands:
            - echo "ğŸ” Starting pre-build phase for NC State Sports Hub"
            - echo "Node version:" && node --version
            - echo "NPM version:" && npm --version
            - echo "Installing dependencies..."
            - npm ci
            - echo "Running security audit..."
            - npm audit --audit-level high || echo "Security audit completed with warnings"
            - echo "Running linting checks..."
            - npm run lint:check
            - echo "Running TypeScript type checking..."
            - npm run type-check
            - echo "Pre-build phase completed âœ…"
        build:
          commands:
            - echo "ğŸ—ï¸ Starting build phase for NC State Sports Hub"
            - echo "Building Next.js application..."
            - npm run build
            - echo "Running unit tests..."
            - npm run test -- --passWithNoTests --watchAll=false --coverage
            - echo "Build phase completed âœ…"
        postBuild:
          commands:
            - echo "ğŸš€ Starting post-build phase for NC State Sports Hub"
            - echo "Build completed successfully at $(date)"
            - echo "Checking build artifacts..."
            - ls -la .next/
            - echo "Post-build phase completed âœ…"
      artifacts:
        baseDirectory: .next
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*
          - .next/cache/**/*
    backend:
      phases:
        preBuild:
          commands:
            - echo "ğŸ”§ Starting backend pre-build phase"
            - echo "Installing Amplify CLI..."
            - npm install -g @aws-amplify/cli@latest
            - echo "Backend pre-build phase completed âœ…"
        build:
          commands:
            - echo "ğŸ—ï¸ Starting backend build phase"
            - echo "Deploying backend resources..."
            - amplify push --yes
            - echo "Backend build phase completed âœ…"
        postBuild:
          commands:
            - echo "ğŸ” Starting backend post-build phase"
            - echo "Running backend health checks..."
            - amplify status
            - echo "Backend post-build phase completed âœ…"